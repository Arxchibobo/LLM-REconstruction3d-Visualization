# 3D Workspace Session Manager â€” å®ç°è®¡åˆ’

> **ç›®æ ‡**: æ–°å»º `/workspace` é¡µé¢ï¼Œç”¨æˆ·å¯åœ¨ä¸‰ç»´ç”»å¸ƒä¸­åˆ›å»ºå¤šä¸ª Sessionï¼Œ
> æ‹–æ‹½ Skill/Plugin/MCP ç­‰æ¨¡å—åˆ° Session ä¸­ï¼Œè¾“å…¥éœ€æ±‚ï¼Œè·å¾—å®æ—¶æ¨¡å—æ¨èã€‚

---

## ä¸€ã€æ¶æ„æ€»è§ˆ

```
/workspace (æ–°è·¯ç”±)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ WorkspaceTopBar  [â† è¿”å›/v3]  [+ æ–°å»ºSession]  [æœç´¢]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Module   â”‚                              â”‚ Session       â”‚
â”‚ Palette  â”‚     3D Canvas                â”‚ Panel         â”‚
â”‚          â”‚     (R3F)                    â”‚               â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â” â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚Skill â”‚ â”‚   â”‚Session 1â”‚ â”‚Session 2â”‚   â”‚ â”‚ åç§°      â”‚ â”‚
â”‚ â”‚MCP   â”‚ â”‚   â”‚ â—‹ â—‹ â—‹   â”‚ â”‚ â—‹ â—‹     â”‚   â”‚ â”‚ éœ€æ±‚è¾“å…¥  â”‚ â”‚
â”‚ â”‚Pluginâ”‚ â”‚   â”‚ â—‹ â—‹     â”‚ â”‚ â—‹ â—‹ â—‹   â”‚   â”‚ â”‚ æ¨¡å—åˆ—è¡¨  â”‚ â”‚
â”‚ â”‚Hook  â”‚ â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚ â”‚ æ¨è      â”‚ â”‚
â”‚ â”‚Rule  â”‚ â”‚                              â”‚ â”‚ [å¼€å§‹]    â”‚ â”‚
â”‚ â”‚Agent â”‚ â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”˜ â”‚       â”‚Session 3â”‚            â”‚               â”‚
â”‚          â”‚       â”‚ â—‹       â”‚            â”‚               â”‚
â”‚          â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ WorkspaceStatusBar  Sessions: 3 | Modules: 12 | Ready   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å…³é”®äº¤äº’æµç¨‹**:
1. å·¦ä¾§ Palette â†’ HTML5 Drag æ¨¡å— â†’ æ‹–åˆ° 3D Canvas â†’ Raycast è½ç‚¹
2. è½åœ¨å·²æœ‰ Session ä¸Š â†’ æ¨¡å—åŠ å…¥è¯¥ Session
3. è½åœ¨ç©ºç™½å¤„ â†’ å¼¹å‡º CreateSessionDialog â†’ åˆ›å»ºæ–° Session å¹¶åŠ å…¥æ¨¡å—
4. é€‰ä¸­ Session â†’ å³ä¾§é¢æ¿å±•ç¤ºè¯¦æƒ…/è¾“å…¥éœ€æ±‚ â†’ å®æ—¶æ¨èæ¨¡å—
5. æ¨¡å—é½å…¨+éœ€æ±‚å¡«å†™ â†’ ç‚¹å‡»"å¼€å§‹" â†’ Session çŠ¶æ€å˜ä¸º running

---

## äºŒã€æ–°å¢ç±»å‹å®šä¹‰

**æ–‡ä»¶**: `src/types/workspace.ts`

```typescript
// === æ¨¡å—ç±»å‹ï¼ˆPalette ä¸­å¯æ‹–æ‹½çš„å•å…ƒï¼‰ ===
export type ModuleType = 'skill' | 'mcp' | 'plugin' | 'hook' | 'rule' | 'agent' | 'memory';

export interface WorkspaceModule {
  id: string;                    // "skill-commit", "mcp-playwright" ç­‰
  type: ModuleType;
  name: string;
  description: string;
  tags: string[];                // ç”¨äºæ¨èåŒ¹é…
  enabled: boolean;
  icon: string;                  // Lucide icon åç§°
}

// === Session çŠ¶æ€æœº ===
export type SessionStatus = 'drafting' | 'ready' | 'running' | 'completed' | 'failed';

export interface Session {
  id: string;                    // crypto.randomUUID()
  name: string;
  description: string;           // ç”¨æˆ·è¾“å…¥çš„éœ€æ±‚
  moduleIds: string[];           // WorkspaceModule.id å¼•ç”¨
  status: SessionStatus;
  position: [number, number, number];  // 3D ä¸–ç•Œåæ ‡ï¼ˆSession ä¸­å¿ƒï¼‰
  color: string;                 // è‡ªåŠ¨åˆ†é…çš„éœ“è™¹è‰²
  createdAt: number;
  updatedAt: number;
  result?: string;               // å®Œæˆåçš„ç»“æœæ‘˜è¦
}

// === æ¨è ===
export interface ModuleRecommendation {
  moduleId: string;
  score: number;                 // 0-1
  reason: string;
}

// === æ‹–æ‹½çŠ¶æ€ ===
export interface DragState {
  isDragging: boolean;
  draggedModule: WorkspaceModule | null;
  dropTarget: string | null;     // sessionId | 'canvas-empty'
  worldPosition: [number, number, number] | null;
}
```

---

## ä¸‰ã€æ–°å¢ Zustand Store

**æ–‡ä»¶**: `src/stores/useWorkspaceStore.ts`

### çŠ¶æ€

| å­—æ®µ | ç±»å‹ | è¯´æ˜ | æŒä¹…åŒ– |
|------|------|------|--------|
| `modules` | `WorkspaceModule[]` | æ‰€æœ‰å¯ç”¨æ¨¡å—ï¼ˆä» API åŠ è½½ï¼‰ | No |
| `modulesLoading` | `boolean` | åŠ è½½çŠ¶æ€ | No |
| `sessions` | `Session[]` | æ‰€æœ‰ Session | **Yes** (localStorage) |
| `selectedSessionId` | `string \| null` | å½“å‰é€‰ä¸­çš„ Session | No |
| `dragState` | `DragState` | æ‹–æ‹½ä¸­é—´çŠ¶æ€ | No |
| `recommendations` | `ModuleRecommendation[]` | å½“å‰ Session çš„æ¨è | No |
| `paletteOpen` | `boolean` | å·¦ä¾§é¢æ¿å¼€å…³ | No |
| `paletteSearch` | `string` | æœç´¢å…³é”®è¯ | No |
| `paletteFilter` | `ModuleType \| null` | ç±»å‹è¿‡æ»¤ | No |

### æ ¸å¿ƒ Actions

```typescript
// æ¨¡å—åŠ è½½
loadModules(): Promise<void>  // è°ƒç”¨ /api/claude-config â†’ æ‰å¹³åŒ–ä¸º WorkspaceModule[]

// Session CRUD
createSession(name: string, description?: string): string  // è¿”å› sessionId
deleteSession(sessionId: string): void
updateSession(sessionId: string, updates: Partial<Session>): void
setSelectedSession(sessionId: string | null): void
setSessionStatus(sessionId: string, status: SessionStatus): void

// æ¨¡å— â†” Session
addModuleToSession(sessionId: string, moduleId: string): void
removeModuleFromSession(sessionId: string, moduleId: string): void

// æ‹–æ‹½
startDrag(module: WorkspaceModule): void
updateDragWorldPosition(pos: [number, number, number]): void
setDropTarget(target: string | null): void
endDrag(): void
executeDrop(): void  // æ ¹æ® dropTarget æ‰§è¡Œ addModule æˆ– createSession+addModule

// æ¨è
computeRecommendations(sessionId: string): void  // åŸºäº description + å·²æœ‰æ¨¡å— â†’ å…³é”®è¯åŒ¹é…

// è®¡ç®—å±æ€§
getSessionModules(sessionId: string): WorkspaceModule[]  // è¿”å›å®Œæ•´æ¨¡å—å¯¹è±¡
getFilteredPaletteModules(): WorkspaceModule[]  // æœç´¢+è¿‡æ»¤åçš„æ¨¡å—åˆ—è¡¨
```

### æŒä¹…åŒ–ç­–ç•¥

```typescript
persist(storeCreator, {
  name: 'workspace-sessions-v1',
  partialize: (state) => ({
    sessions: state.sessions,
  }),
})
```

åªæŒä¹…åŒ– `sessions`ã€‚æ¨¡å—æ¯æ¬¡ä» API é‡æ–°åŠ è½½ï¼Œä¿è¯æ•°æ®æ–°é²œã€‚

### Session è‡ªåŠ¨å¸ƒå±€

åˆ›å»ºæ–° Session æ—¶è‡ªåŠ¨åˆ†é…ä½ç½®ï¼š
- ç½‘æ ¼å¸ƒå±€ï¼Œé—´è· 35 å•ä½
- ä½äº Y=0 å¹³é¢ï¼ˆXZ å¹³é¢ï¼‰
- ç®—æ³•ï¼š`sessions.length` â†’ è¡Œåˆ—å· â†’ åæ ‡
- é¢œè‰²å¾ªç¯ï¼š`['#00FFFF', '#FF00FF', '#FFFF00', '#FF6B6B', '#4ECDC4', '#45B7D1', '#96E6A1', '#DDA0DD']`

---

## å››ã€æ–°å¢ 3D ç»„ä»¶

### 4.1 WorkspaceScene.tsxï¼ˆä¸» Canvasï¼‰

å¤ç”¨ Scene.tsx çš„æ¨¡å¼ï¼š

```
<Canvas>
  <SpaceBackground />              // å¤ç”¨ç°æœ‰
  <OrbitControls enabled={!isDragging} />
  <WorkspaceCamera />              // ç®€åŒ–ç‰ˆç›¸æœºï¼ˆä¿¯è§†è§’åº¦åå¥½ï¼‰
  <Suspense>
    <WorkspaceGraph />             // æ¸²æŸ“æ‰€æœ‰ Session + Module
  </Suspense>
  <GroundPlane />                  // ç”¨äº Raycast çš„éšå½¢åœ°é¢
  <DragPreview />                  // æ‹–æ‹½æ—¶çš„å¹½çµæ¨¡å—
  <EffectComposer>
    <Bloom intensity={0.5} luminanceThreshold={0.8} />
    <ToneMapping mode={REINHARD} />
  </EffectComposer>
</Canvas>
```

### 4.2 SessionZone.tsxï¼ˆSession 3D åŒºåŸŸï¼‰

è§†è§‰è®¾è®¡ï¼š
- **å¹³å°**: `CylinderGeometry(radius=12, height=0.15)` åŠé€æ˜æ·±è‰²
- **è¾¹æ¡†ç¯**: `TorusGeometry(radius=12, tube=0.08)` éœ“è™¹è‰²å‘å…‰
- **æ ‡é¢˜**: `@react-three/drei Html` æµ®äºå¹³å°ä¸Šæ–¹
- **çŠ¶æ€æŒ‡ç¤º**: è¾¹æ¡†é¢œè‰²æ˜ å°„ `draftingâ†’é’ | readyâ†’ç»¿ | runningâ†’è“(è„‰å†²) | completedâ†’é‡‘`
- **é€‰ä¸­æ€**: `@react-spring/three` å¼¹æ€§æ”¾å¤§ 1.05x + è¾¹æ¡†å¢äº®
- **æ‚¬åœæ€**: è¾¹æ¡†å¾®äº® + é¼ æ ‡ pointer

äº¤äº’ï¼š
- `onClick` â†’ `setSelectedSession(id)`
- `onPointerEnter/Leave` â†’ é«˜äº® + æ‹–æ‹½æ—¶è®¾ç½® dropTarget

### 4.3 ModuleNode.tsxï¼ˆæ¨¡å— 3D èŠ‚ç‚¹ï¼‰

è§†è§‰è®¾è®¡ï¼š
- å¤ç”¨ `NODE_TYPE_SHAPES` æ˜ å°„ï¼ˆskillâ†’torus, mcpâ†’cylinder, pluginâ†’dodecahedron...ï¼‰
- å¤ç”¨ `NODE_TYPE_COLORS` é…è‰²
- å°ºå¯¸ç¼©å°ï¼šbase size 0.5ï¼ˆvs PlanetNode 0.8ï¼‰
- `Billboard` æ ‡ç­¾æ˜¾ç¤ºæ¨¡å—å
- ç®€åŒ–ç€è‰²å™¨ï¼ˆçº¯è‰²å‘å…‰ï¼Œä¸éœ€è¦è¡Œæ˜Ÿè¡¨é¢çº¹ç†ï¼‰

å¸ƒå±€ï¼ˆSession å†…éƒ¨ï¼‰ï¼š
- 1 ä¸ªæ¨¡å—ï¼šSession ä¸­å¿ƒåç§» (0, 0.8, 0)
- 2-6 ä¸ªï¼šåœ†å½¢æ’åˆ— radius=5
- 7-10 ä¸ªï¼šåŒç¯ï¼ˆå†…ç¯ radius=4, å¤–ç¯ radius=8ï¼‰

### 4.4 GroundPlane.tsxï¼ˆRaycast æ¥æ”¶é¢ï¼‰

- ä¸å¯è§çš„ `PlaneGeometry(500, 500)` ä½äº Y=0
- `onPointerMove` å®æ—¶æ›´æ–° raycast ä¸–ç•Œåæ ‡ï¼ˆä»…åœ¨æ‹–æ‹½æ—¶ï¼‰
- `onPointerUp` æ‰§è¡Œ drop

### 4.5 DragPreview.tsxï¼ˆæ‹–æ‹½å¹½çµï¼‰

- å½“ `dragState.isDragging` æ—¶æ¸²æŸ“
- åœ¨ `dragState.worldPosition` å¤„æ˜¾ç¤ºåŠé€æ˜æ¨¡å—èŠ‚ç‚¹
- è·Ÿéšé¼ æ ‡åœ¨åœ°é¢ä¸Šçš„æŠ•å½±ç§»åŠ¨

### 4.6 SessionConnections.tsxï¼ˆSession å†…è¿çº¿ï¼‰

- Session å†…æ‰€æœ‰æ¨¡å— â†’ Session ä¸­å¿ƒçš„è¿çº¿
- ä½¿ç”¨ `QuadraticBezierLine`ï¼ˆå¤ç”¨ç°æœ‰æ¨¡å¼ï¼‰
- é¢œè‰²è·Ÿéš Session çš„ accent colorï¼ŒåŠé€æ˜

---

## äº”ã€æ–°å¢ UI ç»„ä»¶

### 5.1 ModulePalette.tsxï¼ˆå·¦ä¾§æ¨¡å—é¢æ¿ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ” æœç´¢æ¨¡å—...       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [All][Skill][MCP]... â”‚  â† ç±»å‹è¿‡æ»¤ Pills
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â–¼ Skills (81)        â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ ğŸŸ¢ commit      â”‚ â”‚  â† draggable
â”‚   â”‚ ğŸŸ¢ code-review â”‚ â”‚
â”‚   â”‚ ğŸŸ¢ write-tests â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â–¼ MCPs (5)           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚ ğŸ”µ playwright  â”‚ â”‚
â”‚   â”‚ ğŸ”µ bytebase    â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ â–¼ Plugins (12)       â”‚
â”‚ â–¼ Hooks (6)          â”‚
â”‚ â–¼ Rules (8)          â”‚
â”‚ â–¼ Agents (9)         â”‚
â”‚ â–¼ Memory (4)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- æ ·å¼å¤ç”¨ `ModernLeftPanel.tsx` çš„èµ›åšæœ‹å…‹é£æ ¼
- æ¯ä¸ªæ¨¡å— `draggable="true"`
- `onDragStart` â†’ `store.startDrag(module)`
- `onDragEnd` â†’ `store.endDrag()`
- æ‹–æ‹½æ—¶æ˜¾ç¤ºè‡ªå®šä¹‰ drag imageï¼ˆæ¨¡å—å¡ç‰‡ç¼©ç•¥å›¾ï¼‰

### 5.2 SessionPanel.tsxï¼ˆå³ä¾§ Session è¯¦æƒ…ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session: "API å¼€å‘"   â”‚  â† å¯ç¼–è¾‘åç§°
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“ éœ€æ±‚æè¿°           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ æˆ‘éœ€è¦å®ç°ä¸€ä¸ª     â”‚â”‚  â† textarea, è¾“å…¥è§¦å‘æ¨è
â”‚ â”‚ RESTful API...     â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ“¦ å·²åŠ è½½æ¨¡å— (3)     â”‚
â”‚   ğŸŸ¢ commit      [Ã—] â”‚
â”‚   ğŸ”µ bytebase    [Ã—] â”‚
â”‚   ğŸŸ¡ fastapi-pro [Ã—] â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ’¡ æ¨èæ¨¡å—           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸŸ¢ write-tests   â”‚ â”‚  â† score: 0.8
â”‚  â”‚ "Tags: api, test"â”‚ â”‚
â”‚  â”‚        [+ æ·»åŠ ]  â”‚ â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚  â”‚ ğŸŸ¢ code-review   â”‚ â”‚  â† score: 0.6
â”‚  â”‚        [+ æ·»åŠ ]  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ çŠ¶æ€: Drafting        â”‚
â”‚ [â–¶ å¼€å§‹ Session]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- æ—  Session é€‰ä¸­æ—¶æ˜¾ç¤ºç©ºçŠ¶æ€å¼•å¯¼
- éœ€æ±‚è¾“å…¥æ¡† onChange 500ms debounce â†’ `computeRecommendations()`
- "å¼€å§‹ Session" æŒ‰é’®ï¼šstatus â†’ 'ready' â†’ 'running'

### 5.3 WorkspaceTopBar.tsx

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â—€ 3D Graph  â”‚  ğŸ§Š Workspace  â”‚  [+ New Session]  â”‚ âš™ï¸  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- å·¦ä¾§ï¼šé¡µé¢åˆ‡æ¢ï¼ˆ`/v3` â†” `/workspace`ï¼‰ï¼Œç”¨ Next.js `<Link>`
- ä¸­é—´ï¼šæ ‡é¢˜
- å³ä¾§ï¼šæ–°å»º Session æŒ‰é’® + è®¾ç½®

### 5.4 WorkspaceStatusBar.tsx

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Sessions: 3  â”‚  Modules: 12  â”‚  Drafting: 1  Running: 2 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 5.5 CreateSessionDialog.tsx

- åŸºäº `@radix-ui/react-dialog`ï¼ˆå·²åœ¨ dependenciesï¼‰
- è¾“å…¥ï¼šSession åç§°ï¼ˆå¿…å¡«ï¼‰+ éœ€æ±‚æè¿°ï¼ˆé€‰å¡«ï¼‰
- ç¡®è®¤ â†’ `createSession(name, description)` â†’ å…³é—­ Dialog

---

## å…­ã€æ‹–æ‹½æ¶æ„ï¼ˆHTML â†’ 3Dï¼‰

### æµç¨‹å›¾

```
ModulePalette (HTML)          Canvas Container (HTML)         R3F Scene (WebGL)
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€               â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
onDragStart
  â†’ store.startDrag(module)
  â†’ setDragImage()
                              onDragOver (preventDefault)
                                â†’ getNativeEvent coords
                                â†’ raycast to Y=0 plane
                                â†’ store.updateDragWorldPosition
                                                              DragPreview renders
                                                              at worldPosition

                                                              SessionZone detects
                                                              proximity â†’ highlight
                              onDrop
                                â†’ store.executeDrop()
                                  if dropTarget=session
                                    â†’ addModuleToSession()
                                  if dropTarget=null
                                    â†’ open CreateSessionDialog
                                    â†’ createSession + add
onDragEnd
  â†’ store.endDrag()
```

### Raycast å·¥å…·

**æ–‡ä»¶**: `src/utils/workspaceRaycast.ts`

```typescript
import { Raycaster, Vector2, Vector3, Plane, Camera } from 'three';

const raycaster = new Raycaster();
const groundPlane = new Plane(new Vector3(0, 1, 0), 0);

export function screenToWorld(
  clientX: number, clientY: number,
  canvasRect: DOMRect, camera: Camera
): Vector3 | null {
  const mouse = new Vector2(
    ((clientX - canvasRect.left) / canvasRect.width) * 2 - 1,
    -((clientY - canvasRect.top) / canvasRect.height) * 2 + 1
  );
  raycaster.setFromCamera(mouse, camera);
  const target = new Vector3();
  return raycaster.ray.intersectPlane(groundPlane, target) ? target : null;
}

export function findNearestSession(
  worldPos: Vector3,
  sessions: Session[],
  radius: number = 12
): string | null {
  for (const s of sessions) {
    const dist = worldPos.distanceTo(new Vector3(...s.position));
    if (dist <= radius) return s.id;
  }
  return null;
}
```

### å…³é”®å¤„ç†ï¼šOrbitControls å†²çª

æ‹–æ‹½æœŸé—´ç¦ç”¨ OrbitControlsï¼š
```tsx
<OrbitControls enabled={!dragState.isDragging} />
```

### å…³é”®å¤„ç†ï¼šç›¸æœºå¼•ç”¨

éœ€è¦ä» R3F Canvas å†…éƒ¨æš´éœ² camera å¼•ç”¨ç»™å¤–éƒ¨ HTML drop handlerã€‚
æ–¹æ¡ˆï¼šé€šè¿‡ Zustand store å­˜ä¸€ä¸ª `cameraRef`ï¼Œåœ¨ WorkspaceScene å†…éƒ¨é€šè¿‡ `useThree()` è·å–åå†™å…¥ storeã€‚

---

## ä¸ƒã€æ¨èå¼•æ“

**æ–‡ä»¶**: `src/utils/recommendations.ts`

### ç®—æ³•

```
è¾“å…¥: session.description + session.name + å·²æœ‰ moduleIds
è¾“å‡º: ModuleRecommendation[] (top 5, score > 0.1)

1. åˆ†è¯: tokenize(description + name) â†’ Set<keyword>
   - ç§»é™¤åœç”¨è¯ï¼ˆthe, a, is, çš„, æ˜¯...ï¼‰
   - æ”¯æŒä¸­è‹±æ–‡

2. å¯¹æ¯ä¸ªæœªåŠ å…¥ Session çš„æ¨¡å—è®¡ç®—åˆ†æ•°:
   a. Tag åŒ¹é… (æ¯ä¸ªåŒ¹é… tag +0.3)      â†’ æœ€å¼ºä¿¡å·
   b. æ¨¡å—ååŒ…å«å…³é”®è¯ (+0.4)             â†’ ç›´æ¥å‘½ä¸­
   c. æ¨¡å—æè¿°ä¸å…³é”®è¯é‡å  (+0.1/è¯, ä¸Šé™0.3)
   d. ç±»å‹äº²å’Œåº¦ (Session å·²æœ‰åŒç±»å‹ +0.1)

3. è¿‡æ»¤ score > 0.1, å– top 5, æŒ‰ score é™åº

è§¦å‘æ—¶æœº:
  - description textarea onChange (debounced 500ms)
  - addModuleToSession / removeModuleFromSession å
```

---

## å…«ã€æ–‡ä»¶ç»“æ„æ€»è§ˆ

```
src/
â”œâ”€â”€ app/workspace/
â”‚   â””â”€â”€ page.tsx                          # æ–°é¡µé¢
â”œâ”€â”€ types/
â”‚   â””â”€â”€ workspace.ts                      # æ–°ç±»å‹
â”œâ”€â”€ stores/
â”‚   â””â”€â”€ useWorkspaceStore.ts              # æ–° Store
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ workspace-scene/                  # æ–° 3D ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ WorkspaceScene.tsx            # Canvas ä¸»å®¹å™¨
â”‚   â”‚   â”œâ”€â”€ WorkspaceGraph.tsx            # æ¸²æŸ“ç¼–æ’å™¨
â”‚   â”‚   â”œâ”€â”€ SessionZone.tsx               # Session 3D åŒºåŸŸ
â”‚   â”‚   â”œâ”€â”€ ModuleNode.tsx                # æ¨¡å— 3D èŠ‚ç‚¹
â”‚   â”‚   â”œâ”€â”€ SessionConnections.tsx        # Session å†…è¿çº¿
â”‚   â”‚   â”œâ”€â”€ GroundPlane.tsx               # Raycast æ¥æ”¶é¢
â”‚   â”‚   â””â”€â”€ DragPreview.tsx               # æ‹–æ‹½å¹½çµ
â”‚   â””â”€â”€ workspace-ui/                     # æ–° UI ç»„ä»¶
â”‚       â”œâ”€â”€ ModulePalette.tsx             # å·¦ä¾§æ¨¡å—é¢æ¿
â”‚       â”œâ”€â”€ SessionPanel.tsx              # å³ä¾§è¯¦æƒ…é¢æ¿
â”‚       â”œâ”€â”€ WorkspaceTopBar.tsx           # é¡¶éƒ¨å¯¼èˆª
â”‚       â”œâ”€â”€ WorkspaceStatusBar.tsx        # åº•éƒ¨çŠ¶æ€æ 
â”‚       â”œâ”€â”€ CreateSessionDialog.tsx       # æ–°å»º Session å¯¹è¯æ¡†
â”‚       â””â”€â”€ RecommendationCard.tsx        # æ¨èå¡ç‰‡
â”œâ”€â”€ utils/
â”‚   â”œâ”€â”€ workspaceLayout.ts                # Session/Module å¸ƒå±€ç®—æ³•
â”‚   â”œâ”€â”€ workspaceRaycast.ts               # å±å¹•åæ ‡ â†’ ä¸–ç•Œåæ ‡
â”‚   â””â”€â”€ recommendations.ts                # æ¨èå¼•æ“
```

**æ–°å¢æ–‡ä»¶: 17 ä¸ª**
**ä¿®æ”¹æ–‡ä»¶: 1 ä¸ª** (`ModernTopBar.tsx` â€” åŠ å¯¼èˆªé“¾æ¥ï¼Œçº¦ 5 è¡Œï¼‰

---

## ä¹ã€å®ç°é˜¶æ®µ

### Phase 1: åŸºç¡€éª¨æ¶ï¼ˆç±»å‹ + Store + è·¯ç”±ï¼‰

**å‰ç½®ä¾èµ–**: æ— 

- [ ] 1.1 åˆ›å»º `src/types/workspace.ts` â€” æ‰€æœ‰ç±»å‹å®šä¹‰
- [ ] 1.2 åˆ›å»º `src/stores/useWorkspaceStore.ts` â€” Store éª¨æ¶ + loadModules action
- [ ] 1.3 åˆ›å»º `src/app/workspace/page.tsx` â€” é¡µé¢æ¡†æ¶ï¼ˆæ—  3Dï¼‰
- [ ] 1.4 åˆ›å»º `WorkspaceTopBar.tsx` â€” é¡¶éƒ¨å¯¼èˆª
- [ ] 1.5 åˆ›å»º `WorkspaceStatusBar.tsx` â€” åº•éƒ¨çŠ¶æ€æ 
- [ ] 1.6 éªŒè¯ï¼š`npm run dev` â†’ è®¿é—® `/workspace` â†’ çœ‹åˆ°éª¨æ¶ UI

### Phase 2: æ¨¡å—é¢æ¿ + Session CRUD

**å‰ç½®ä¾èµ–**: Phase 1

- [ ] 2.1 åˆ›å»º `ModulePalette.tsx` â€” å·¦ä¾§é¢æ¿ï¼ˆæœç´¢ + è¿‡æ»¤ + åˆ†ç»„åˆ—è¡¨ï¼‰
- [ ] 2.2 åˆ›å»º `CreateSessionDialog.tsx` â€” æ–°å»ºå¯¹è¯æ¡†
- [ ] 2.3 å®ç° Session CRUD actionsï¼ˆcreate/delete/update/selectï¼‰
- [ ] 2.4 åˆ›å»º `SessionPanel.tsx` â€” å³ä¾§è¯¦æƒ…é¢æ¿ï¼ˆåç§° + æè¿° + æ¨¡å—åˆ—è¡¨ï¼‰
- [ ] 2.5 å®ç° localStorage æŒä¹…åŒ–
- [ ] 2.6 éªŒè¯ï¼šæµè§ˆæ¨¡å— â†’ åˆ›å»º/åˆ é™¤ Session â†’ åˆ·æ–°å Session ä¿ç•™

### Phase 3: 3D åœºæ™¯ + Session å¯è§†åŒ–

**å‰ç½®ä¾èµ–**: Phase 2

- [ ] 3.1 åˆ›å»º `src/utils/workspaceLayout.ts` â€” ç½‘æ ¼å¸ƒå±€ + åœ†å½¢æ¨¡å—æ’åˆ—
- [ ] 3.2 åˆ›å»º `WorkspaceScene.tsx` â€” R3F Canvas å®¹å™¨
- [ ] 3.3 åˆ›å»º `SessionZone.tsx` â€” Session 3D å¹³å°
- [ ] 3.4 åˆ›å»º `ModuleNode.tsx` â€” æ¨¡å— 3D èŠ‚ç‚¹ï¼ˆç®€åŒ–ç‰ˆ PlanetNodeï¼‰
- [ ] 3.5 åˆ›å»º `WorkspaceGraph.tsx` â€” ç¼–æ’ Session + Module æ¸²æŸ“
- [ ] 3.6 åˆ›å»º `SessionConnections.tsx` â€” Session å†…æ¨¡å—è¿çº¿
- [ ] 3.7 éªŒè¯ï¼šSession åœ¨ 3D ç©ºé—´æ˜¾ç¤º â†’ ç‚¹å‡»é€‰ä¸­ â†’ æ¨¡å—åœ¨ Session å†…æ’åˆ—

### Phase 4: æ‹–æ‹½ç³»ç»Ÿ

**å‰ç½®ä¾èµ–**: Phase 3

- [ ] 4.1 åˆ›å»º `src/utils/workspaceRaycast.ts` â€” åæ ‡è½¬æ¢
- [ ] 4.2 ModulePalette åŠ  `draggable` + HTML5 Drag API
- [ ] 4.3 workspace/page.tsx åŠ  `onDragOver` / `onDrop` å¤„ç†
- [ ] 4.4 Store æš´éœ² camera refï¼ˆR3F â†’ Zustand â†’ HTML handlerï¼‰
- [ ] 4.5 åˆ›å»º `GroundPlane.tsx` â€” ä¸å¯è§ Raycast é¢
- [ ] 4.6 åˆ›å»º `DragPreview.tsx` â€” å¹½çµæ¨¡å—è·Ÿéš
- [ ] 4.7 SessionZone åŠ æ‹–æ‹½æ‚¬åœæ£€æµ‹ï¼ˆdropTarget é«˜äº®ï¼‰
- [ ] 4.8 å®ç° `executeDrop()` â€” è½å…¥ Session æˆ–åˆ›å»ºæ–° Session
- [ ] 4.9 éªŒè¯ï¼šä»é¢æ¿æ‹–æ¨¡å— â†’ 3D å¹½çµè·Ÿéš â†’ è½åˆ° Session â†’ æ¨¡å—åŠ å…¥

### Phase 5: æ¨èå¼•æ“ + é¡µé¢äº’é€š

**å‰ç½®ä¾èµ–**: Phase 4

- [ ] 5.1 åˆ›å»º `src/utils/recommendations.ts` â€” å…³é”®è¯åŒ¹é…æ¨èç®—æ³•
- [ ] 5.2 SessionPanel åŠ æ¨èåŒºåŸŸ
- [ ] 5.3 åˆ›å»º `RecommendationCard.tsx` â€” æ¨èå¡ç‰‡ UI
- [ ] 5.4 description textarea â†’ debounce â†’ computeRecommendations
- [ ] 5.5 ModernTopBar.tsx åŠ  `/workspace` å¯¼èˆªé“¾æ¥
- [ ] 5.6 éªŒè¯ï¼šè¾“å…¥éœ€æ±‚ â†’ æ¨èæ¨¡å—å‡ºç° â†’ ç‚¹å‡»æ·»åŠ  â†’ æ¨èæ›´æ–°

### Phase 6: è§†è§‰æ‰“ç£¨ + æ€§èƒ½ä¼˜åŒ–

**å‰ç½®ä¾èµ–**: Phase 5

- [ ] 6.1 SessionZone åŠ¨ç”»ï¼šspring ç¼©æ”¾ã€è„‰å†²è¾¹æ¡†ã€çŠ¶æ€è‰²
- [ ] 6.2 ModuleNode å‘å…‰æ•ˆæœ + æ‚¬åœæ”¾å¤§
- [ ] 6.3 DragPreview åŠé€æ˜ + è½ç‚¹æŒ‡ç¤ºå™¨
- [ ] 6.4 Session çŠ¶æ€æŒ‡ç¤ºï¼ˆè¾¹æ¡†é¢œè‰²ã€æ ‡é¢˜å¾½ç« ï¼‰
- [ ] 6.5 ç©ºçŠ¶æ€å¼•å¯¼ UIï¼ˆæ—  Session æ—¶çš„æç¤ºï¼‰
- [ ] 6.6 Loading states + é”™è¯¯å¤„ç†
- [ ] 6.7 æ€§èƒ½ï¼š10+ Session åœºæ™¯æµ‹è¯•ï¼Œå¿…è¦æ—¶ InstancedMesh
- [ ] 6.8 æœ€ç»ˆéªŒè¯ï¼š`npm run dev` â†’ å®Œæ•´æµç¨‹èµ°é€š â†’ è§†è§‰ç¡®è®¤

---

## åã€æŠ€æœ¯å†³ç­–

| å†³ç­– | é€‰æ‹© | åŸå›  |
|------|------|------|
| æ‹–æ‹½æ–¹æ¡ˆ | HTML5 Drag API + Raycast | è·¨ HTML/WebGL åŸŸï¼Œdrei DragControls æ— æ³•å¤„ç† |
| Session å¸ƒå±€ | Y=0 å¹³é¢ç½‘æ ¼ | ç¬¦åˆé¡¹ç›®çº¦å®šï¼ˆæ‰€æœ‰å¸ƒå±€ç”¨ Y=0ï¼‰ï¼Œç®€å•ç›´è§‚ |
| Module æ¸²æŸ“ | ç®€åŒ–ç‰ˆ PlanetNode | å®Œæ•´ç‰ˆ 400+ è¡Œå«å¤æ‚ç€è‰²å™¨ï¼ŒModule éœ€è½»é‡åŒ– |
| æŒä¹…åŒ– | localStorage (zustand persist) | é›¶åŸºç¡€è®¾æ–½ï¼Œç°æœ‰é¡¹ç›®æ¨¡å¼ |
| æ¨èç®—æ³• | å®¢æˆ·ç«¯å…³é”®è¯åŒ¹é… | 200 ä¸ªæ¨¡å— + å­—ç¬¦ä¸²åŒ¹é… <5msï¼Œæ— éœ€åç«¯ |
| çŠ¶æ€ç®¡ç† | ç‹¬ç«‹ Store (useWorkspaceStore) | ä¸ /v3 çš„ useKnowledgeStore å®Œå…¨éš”ç¦» |
| Session åŒºåŸŸå½¢çŠ¶ | æ‰å¹³åœ†æŸ± + ç¯å½¢è¾¹æ¡† | ä¸ PlanetNode çƒä½“è§†è§‰åŒºåˆ†æ˜ç¡® |
| æ–°å¢ä¾èµ– | **æ— ** | æ‰€æœ‰æŠ€æœ¯æ ˆå·²åœ¨ package.json ä¸­ |

---

## åä¸€ã€é£é™©ä¸å¯¹ç­–

| é£é™© | å¯¹ç­– |
|------|------|
| HTML Drag + Canvas pointer äº‹ä»¶å†²çª | çˆ¶ div å¤„ç† dragover/dropï¼ŒR3F Canvas å¤„ç† pointer |
| åæ ‡ç³»è½¬æ¢ç²¾åº¦ | ä½¿ç”¨ Raycaster + åœ°é¢ Plane äº¤ç‚¹ï¼Œé¿å…è§†è§’ä¾èµ– |
| æ‹–æ‹½æœŸé—´ OrbitControls è¯¯è§¦å‘ | `enabled={!isDragging}` æ¡ä»¶ç¦ç”¨ |
| æ¨¡å— ID è·¨ Session å¼•ç”¨ä¸ä¸€è‡´ | modules æ¯æ¬¡ä» API åŠ è½½ï¼ŒSession åªå­˜ moduleIds |
| localStorage æ•°æ®è¿ç§» | key å¸¦ç‰ˆæœ¬å· `workspace-sessions-v1` |
| åˆå§‹åŒ–æ—¶ modules æœªåŠ è½½å®Œ Session å·²æ¸²æŸ“ | SessionPanel æ˜¾ç¤º skeleton ç›´åˆ° modules.length > 0 |

---

## åäºŒã€éªŒæ”¶æ ‡å‡†

- [ ] `/workspace` é¡µé¢å¯æ­£å¸¸è®¿é—®ï¼ŒUI å®Œæ•´
- [ ] å·¦ä¾§é¢æ¿æ˜¾ç¤ºæ‰€æœ‰ skill/mcp/plugin/hook/rule/agent/memoryï¼Œå¯æœç´¢è¿‡æ»¤
- [ ] å¯åˆ›å»ºæ–° Sessionï¼ˆåç§° + æè¿°ï¼‰
- [ ] Session åœ¨ 3D ç©ºé—´ä»¥å¹³å°å½¢å¼æ˜¾ç¤ºï¼Œå¯ç‚¹å‡»é€‰ä¸­
- [ ] ä»é¢æ¿æ‹–æ‹½æ¨¡å—åˆ° Session ä¸Šï¼Œ3D å®æ—¶åé¦ˆ
- [ ] æ‹–åˆ°ç©ºç™½å¤„å¼¹å‡ºæ–°å»ºå¯¹è¯æ¡†
- [ ] é€‰ä¸­ Session å³ä¾§é¢æ¿æ˜¾ç¤ºè¯¦æƒ…ï¼Œå¯ç¼–è¾‘éœ€æ±‚
- [ ] è¾“å…¥éœ€æ±‚åæ¨èæ¨¡å—è‡ªåŠ¨å‡ºç°
- [ ] å¤šä¸ª Session åŒæ—¶å­˜åœ¨ä¸å¡é¡¿ï¼ˆâ‰¤10 ä¸ªï¼‰
- [ ] åˆ·æ–°é¡µé¢ Session æ•°æ®ä¿ç•™
- [ ] `/v3` å’Œ `/workspace` å¯äº’ç›¸è·³è½¬
- [ ] æ•´ä½“è§†è§‰é£æ ¼ä¸ç°æœ‰èµ›åšæœ‹å…‹é£ä¸€è‡´
